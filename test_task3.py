import unittest
import json

import requests

from task3 import appearance



class MyTestCase(unittest.TestCase):
    def test_correctness(self):
        dct1 = {
            'lesson': [1, 5],
            'tutor': [1, 5],
            'pupil': [1, 5]
        }
        dct2 = {
            'lesson': [1, 1],
            'tutor': [1, 5],
            'pupil': [1, 5]
        }
        dct3 = {
            'lesson': [0, 12],
            'tutor': [1, 5, 6, 9],
            'pupil': [1, 5, 9, 11]
        }
        dct4 = {
            'lesson': [2, 20],
            'tutor': [0, 5, 6, 16, 18, 20],
            'pupil': [1, 5, 7, 10, 13, 15, 21, 22]
        }
        dct5 = {
            'lesson': [10, 60],
            'tutor': [3, 10, 12, 20, 25, 38, 48, 49, 55, 63],
            'pupil': [0, 4, 7, 13, 15, 18, 25, 26, 28, 30, 32, 36, 39, 41, 43, 45, 48, 64]
        }

        self.assertEqual(appearance(dct1), 4)
        self.assertEqual(appearance(dct2), 0)
        self.assertEqual(appearance(dct3), 4)
        self.assertEqual(appearance(dct4), 8)
        self.assertEqual(appearance(dct5), 17)

        tests = [
            {'data': {'lesson': [1594663200, 1594666800],
                      'pupil': [1594663340, 1594663389, 1594663390, 1594663395, 1594663396, 1594666472],
                      'tutor': [1594663290, 1594663430, 1594663443, 1594666473]},
             'answer': 3117
             },
            {'data': {'lesson': [1594702800, 1594706400],
                      'pupil': [1594702789, 1594704500, 1594702807, 1594704542, 1594704512, 1594704513, 1594704564,
                                1594705150, 1594704581, 1594704582, 1594704734, 1594705009, 1594705095, 1594705096,
                                1594705106, 1594706480, 1594705158, 1594705773, 1594705849, 1594706480, 1594706500,
                                1594706875, 1594706502, 1594706503, 1594706524, 1594706524, 1594706579, 1594706641],
                      'tutor': [1594700035, 1594700364, 1594702749, 1594705148, 1594705149, 1594706463]},
             'answer': 3577
             },
            {'data': {'lesson': [1594692000, 1594695600],
                      'pupil': [1594692033, 1594696347],
                      'tutor': [1594692017, 1594692066, 1594692068, 1594696341]},
             'answer': 3565
             },
        ]

        for test in tests:
            self.assertEqual(appearance(test['data']), test['answer'])


    def test_api(self):
        url = 'http://localhost:3333/'
        body = {'lesson': [1594702800, 1594706400],
                'pupil': [1594702789, 1594704500, 1594702807, 1594704542, 1594704512, 1594704513, 1594704564,
                          1594705150, 1594704581, 1594704582, 1594704734, 1594705009, 1594705095, 1594705096,
                          1594705106, 1594706480, 1594705158, 1594705773, 1594705849, 1594706480, 1594706500,
                          1594706875, 1594706502, 1594706503, 1594706524, 1594706524, 1594706579, 1594706641],
                'tutor': [1594700035, 1594700364, 1594702749, 1594705148, 1594705149, 1594706463]}
        answer = requests.get(url, data=json.dumps(body)).json()['answer']
        self.assertEqual(answer, 3577)


if __name__ == '__main__':
    unittest.main()
